<!DOCTYPE html>
<!-- saved from url=(0060)https://new-webpage-4won21ups-otto-kats-projects.vercel.app/ -->
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>自然窥探者 · LeanCloud 上传系统</title>

    <!-- LeanCloud SDK -->
    <script src="./自然窥探者 · LeanCloud 上传系统_files/av-min.js.下载"></script>
    <style type="text/css" class="print-ignore-style">
        @media print {
            .print-ignore {
                display: none !important;
            }
        }
    </style>

    <!-- 粒子背景 -->
    <script src="./自然窥探者 · LeanCloud 上传系统_files/particles.min.js.下载"></script>

    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [
                    ["\\(", "\\)"],
                    ["$", "$"],
                ],
                displayMath: [
                    ["$$", "$$"],
                    ["\\[", "\\]"],
                ],
            },
            options: {
                skipHtmlTags: ["script", "noscript", "style", "textarea", "pre", "code"],
            },
        };
    </script>
    <script id="MathJax-script"
            async=""
            src="./自然窥探者 · LeanCloud 上传系统_files/tex-mml-chtml.js.下载"></script>

    <style>
        :root {
            --bg1: #101522;
            --bg2: #1e293b;
            --card: rgba(255, 255, 255, 0.08);
            --text: #f1f5f9;
            --muted: #94a3b8;
            --accent: #3b82f6;
            --radius: 12px;
        }

        body {
            font-family: Inter, "Microsoft YaHei", system-ui;
            background: linear-gradient(160deg, var(--bg1), var(--bg2));
            color: var(--text);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .card {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: 0 6px 20px rgba(15, 23, 40, 0.3);
            padding: 16px;
            max-width: 680px;
            margin: 40px auto;
            backdrop-filter: blur(10px);
        }

        input,
        textarea {
            width: 100%;
            margin: 6px 0;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        button {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
        }

            button:hover {
                background: #2563eb;
            }

        .comment {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 10px;
            padding-top: 10px;
        }

        .file-link {
            color: #60a5fa;
            font-size: 13px;
            text-decoration: underline;
        }

        .about {
            font-size: 13px;
            color: var(--muted);
            text-align: center;
            margin-top: 20px;
        }

        #markdownPreview {
            background: rgba(255, 255, 255, 0.06);
            border-radius: 8px;
            padding: 10px;
            margin-top: 8px;
        }
    </style>
</head>

<body>
    <div id="particles-js"></div>

    <div class="card">
        <h2>自然窥探者 · LeanCloud 上传系统</h2>
        <p>上传 PDF 或图片评论，全网可见</p>

        <input id="name" placeholder="名字 (必填)" />
        <input id="email" placeholder="邮箱 (可选)" />
        <textarea id="text" placeholder="评论内容 (支持 Markdown 与 LaTeX)"></textarea>
        <input id="fileInput" type="file" accept="application/pdf,image/png,image/jpeg" />
        <button id="submitBtn">提交评论</button>

        <div id="status" style="margin-top: 6px; font-size: 13px; color: #94a3b8"></div>
        <div id="markdownPreview">*Markdown 实时预览 / Live Preview*</div>

        <h3 style="margin-top: 20px">已有评论</h3>
        <div id="comments"></div>

        <div class="about">
            <b>Otto Von Davinstar</b><br />
            “If you want to find the secrets of the universe,<br />
            think in terms of energy, frequency and vibration.”<br />
            — N. Tesla
        </div>
    </div>

    <!-- marked.js for Markdown 解析 -->
    <script type="module">
        import { marked } from "https://cdn.jsdelivr.net/npm/marked@12.0.2/lib/marked.esm.js";

        // ---------- 初始化 LeanCloud ----------
        AV.init({
            appId: "Q2JlmwGNoDKcXuzrp0Th0s7i-gzGzoHsz", // ← 改成你自己的
            appKey: "b5dHHuUgH1AKyXXxtfNfMBLj", // ← 改成你自己的
            serverURL: "https://q2jlmwgn.lc-cn-n1-shared.com", // ← 改成你自己的
        });

        const nameEl = document.getElementById("name");
        const emailEl = document.getElementById("email");
        const textEl = document.getElementById("text");
        const fileEl = document.getElementById("fileInput");
        const previewEl = document.getElementById("markdownPreview");
        const statusEl = document.getElementById("status");
        const commentsEl = document.getElementById("comments");
        const submitBtn = document.getElementById("submitBtn");

        // ---------- Markdown 实时预览 ----------
        textEl.addEventListener("input", async () => {
            previewEl.innerHTML = marked.parse(textEl.value || "*Markdown 实时预览 / Live Preview*");
            if (window.MathJax && MathJax.typesetPromise) {
                try {
                    await MathJax.typesetPromise([previewEl]);
                } catch { }
            }
        });

        // ---------- 提交评论 ----------
        submitBtn.addEventListener("click", async () => {
            const name = nameEl.value.trim();
            const email = emailEl.value.trim();
            const text = textEl.value.trim();
            const file = fileEl.files[0];

            if (!name || !text) return alert("请填写名字与评论内容！");
            statusEl.textContent = "正在上传中...";

            try {
                const Comment = AV.Object.extend("comments");
                const comment = new Comment();
                comment.set("name", name);
                comment.set("email", email);
                comment.set("text", text);

                if (file) {
                    const avFile = new AV.File(file.name, file);
                    await avFile.save();
                    comment.set("fileUrl", avFile.url());
                    comment.set("fileName", file.name);
                }

                await comment.save();
                statusEl.textContent = "✅ 评论已提交！";
                nameEl.value = emailEl.value = textEl.value = "";
                fileEl.value = "";
                previewEl.innerHTML = "*Markdown 实时预览 / Live Preview*";
                loadComments();
            } catch (err) {
                console.error(err);
                statusEl.textContent = "❌ 上传失败，请检查 LeanCloud 设置";
            }
        });

        // ---------- 加载评论 ----------
        async function loadComments() {
            commentsEl.innerHTML = "<p>加载中...</p>";
            const query = new AV.Query("comments");
            query.descending("createdAt");
            try {
                const results = await query.find();
                commentsEl.innerHTML = "";
                for (const item of results) {
                    const div = document.createElement("div");
                    div.className = "comment";
                    const name = item.get("name") || "匿名";
                    const text = marked.parse(item.get("text") || "");
                    const fileUrl = item.get("fileUrl");
                    const fileName = item.get("fileName");
                    const date = item.createdAt ? item.createdAt.toLocaleString() : "";
                    div.innerHTML = `
                  <div><strong>${name}</strong>
                    <span style="color:#94a3b8;font-size:12px;">${date}</span>
                  </div>
                  <div style="margin-top:6px;">${text}</div>
                  ${fileUrl
                            ? `<a class="file-link" href="${fileUrl}" target="_blank">📎 ${fileName}</a>`
                            : ""
                        }
                `;
                    commentsEl.appendChild(div);
                    if (window.MathJax && MathJax.typesetPromise) {
                        await MathJax.typesetPromise([div]);
                    }
                }
            } catch (e) {
                console.error(e);
                commentsEl.innerHTML = "❌ 无法加载评论，请检查 LeanCloud 设置。";
            }
        }

        loadComments();
    </script>

    <script>
        // 粒子背景初始化
        particlesJS("particles-js", {
            particles: {
                number: { value: 90, density: { enable: true, value_area: 800 } },
                color: { value: "#60a5fa" },
                shape: { type: "circle" },
                opacity: { value: 0.5 },
                size: { value: 2 },
                line_linked: {
                    enable: true,
                    distance: 120,
                    color: "#60a5fa",
                    opacity: 0.3,
                    width: 1,
                },
                move: { enable: true, speed: 1.3, out_mode: "bounce" },
            },
            interactivity: {
                events: { onhover: { enable: true, mode: "repulse" } },
                modes: { repulse: { distance: 100 } },
            },
            retina_detect: true,
        });
    </script>
</body>
</html>

